åœ¨ Spring Boot 3.5.0 ä¸­æ•´åˆ Dremio ä¸»è¦æ¶‰åŠæ•°æ®æºé…ç½®ã€æŸ¥è¯¢æ‰§è¡ŒåŠé«˜çº§ç‰¹æ€§ï¼ˆå¦‚ Apache Iceberg çš„ Time Travelï¼‰çš„æ”¯æŒã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å®ç°æ­¥éª¤å’Œæœ€ä½³å®è·µï¼š

---

### ğŸ”§ ä¸€ã€ç¯å¢ƒå‡†å¤‡ä¸ä¾èµ–ç®¡ç†
1. **æ·»åŠ ä¾èµ–**  
   åœ¨ `pom.xml` ä¸­é…ç½® Dremio JDBC é©±åŠ¨å’Œ Spring Boot æ•°æ®å±‚ä¾èµ–ï¼š
   ```xml
   <dependencies>
       <!-- Spring Boot Starter Data JPA (å¯é€‰) -->
       <dependency>
           <groupId>org.springframework.boot</groupId>
           <artifactId>spring-boot-starter-data-jpa</artifactId>
       </dependency>
       <!-- Dremio JDBC é©±åŠ¨ -->
       <dependency>
           <groupId>com.dremio</groupId>
           <artifactId>dremio-jdbc-driver</artifactId>
           <version>24.0.0</version> <!-- ç¡®ä¿ä¸ Dremio æœåŠ¡å™¨ç‰ˆæœ¬åŒ¹é… -->
       </dependency>
   </dependencies>
   ```
   **ä¾èµ–å†²çªå¤„ç†**ï¼šè‹¥å­˜åœ¨ç‰ˆæœ¬å†²çªï¼ˆå¦‚ `jackson-databind`ï¼‰ï¼Œé€šè¿‡ `<exclusions>` æˆ– `dependencyManagement` æ˜¾å¼æŒ‡å®šç‰ˆæœ¬ã€‚

---

### âš™ï¸ äºŒã€é…ç½® Dremio æ•°æ®æº
1. **å¤šç¯å¢ƒé…ç½®ï¼ˆYAML æ ¼å¼ï¼‰**  
   åœ¨ `application.yml` ä¸­å®šä¹‰ Dremio è¿æ¥ï¼Œæ”¯æŒå¼€å‘/ç”Ÿäº§ç¯å¢ƒéš”ç¦»ï¼š
   ```yaml
   spring:
     datasource:
       url: jdbc:dremio:direct=http://dremio-server:9047;schema=my_space
       username: dremio_user
       password: "ENC(åŠ å¯†å¯†ç )" # å»ºè®®ç»“åˆ Jasypt åŠ å¯†
       driver-class-name: com.dremio.jdbc.Driver
   ```
   **å¤šç¯å¢ƒæ‰©å±•**ï¼š  
   - åˆ›å»º `application-dev.yml`ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ã€`application-prod.yml`ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ã€‚
   - åœ¨ `application.yml` ä¸­æ¿€æ´»ç¯å¢ƒï¼š`spring.profiles.active: dev`ã€‚

2. **è¿æ¥æ± ä¼˜åŒ–ï¼ˆå¦‚ HikariCPï¼‰**  
   å¢åŠ è¿æ¥æ± é…ç½®æå‡æ€§èƒ½ï¼š
   ```yaml
   spring:
     datasource:
       hikari:
         maximum-pool-size: 10
         connection-timeout: 30000
         idle-timeout: 600000
   ```

---

### ğŸ” ä¸‰ã€æ‰§è¡Œ Dremio æŸ¥è¯¢
1. **åŸç”Ÿ JDBC æŸ¥è¯¢**  
   é€šè¿‡ `JdbcTemplate` ç›´æ¥æ‰§è¡Œ SQLï¼š
   ```java
   @Autowired
   private JdbcTemplate jdbcTemplate;

   public List<Map<String, Object>> queryDremio(String sql) {
       return jdbcTemplate.queryForList(sql);
   }
   ```
   **ç¤ºä¾‹æŸ¥è¯¢**ï¼š  
   ```sql
   SELECT * FROM s3.ctas.iceberg_blog AT SNAPSHOT '4132119532727284872' -- Time Travel æŸ¥è¯¢
   ```

2. **é›†æˆ Spring Data**  
   è‹¥éœ€ ORM æ”¯æŒï¼Œå¯ç»“åˆ `Spring Data JPA` æˆ–è‡ªå®šä¹‰ Repositoryï¼š
   ```java
   @Repository
   public interface IcebergRepository extends CrudRepository<CatalogSales, Long> {
       @Query(value = "SELECT * FROM s3.ctas.iceberg_blog", nativeQuery = true)
       List<CatalogSales> findAll();
   }
   ```

---

### â³ å››ã€æ”¯æŒ Dremio é«˜çº§ç‰¹æ€§
1. **Apache Iceberg Time Travel**  
   åˆ©ç”¨ Dremio çš„ `AT SNAPSHOT` è¯­æ³•æŸ¥è¯¢å†å²æ•°æ®å¿«ç…§ï¼š
   ```sql
   -- æŸ¥è¯¢ç‰¹å®šå¿«ç…§çš„æ•°æ®
   SELECT * FROM my_table AT SNAPSHOT '1234567890';
   ```
   **ç®¡ç†å¿«ç…§**ï¼š  
   é€šè¿‡ `TABLE(table_history('table_name'))` è·å–å¿«ç…§å†å²ï¼š
   ```sql
   SELECT * FROM TABLE(table_history('s3.ctas.iceberg_blog'));
   ```

2. **è™šæ‹Ÿæ•°æ®é›†ï¼ˆVDSï¼‰é›†æˆ**  
   å°† Time Travel æŸ¥è¯¢ä¿å­˜ä¸ºè™šæ‹Ÿæ•°æ®é›†ï¼Œä¾›ä¸šåŠ¡å±‚å¤ç”¨ï¼š
   ```sql
   CREATE VDS demo.historical_sales AS
   SELECT * FROM s3.ctas.iceberg_blog AT SNAPSHOT '4132119532727284872';
   ```

---

### ğŸŒ äº”ã€å¤šç¯å¢ƒä¸éƒ¨ç½²ä¼˜åŒ–
1. **é…ç½®åˆ†ç¦»ç­–ç•¥**  
   - **é€šç”¨é…ç½®**ï¼š`application.yml`ï¼ˆç«¯å£ã€æ—¥å¿—çº§åˆ«ï¼‰ã€‚  
   - **ç¯å¢ƒä¸“å±é…ç½®**ï¼š`application-{env}.yml`ï¼ˆæ•°æ®æºã€Dremio è¿æ¥ï¼‰ã€‚  
   - **å‘½ä»¤è¡Œæ¿€æ´»ç¯å¢ƒ**ï¼š  
     ```bash
     java -jar app.jar --spring.profiles.active=prod
     ```

2. **åŸç”Ÿç¼–è¯‘æ”¯æŒï¼ˆGraalVMï¼‰**  
   Spring Boot 3.5.0 æ”¯æŒé€šè¿‡ GraalVM ç”ŸæˆåŸç”Ÿé•œåƒï¼Œæå‡ Dremio æŸ¥è¯¢æ€§èƒ½ï¼š  
   - æ·»åŠ  AOT æ’ä»¶ï¼š
     ```xml
     <build>
         <plugins>
             <plugin>
                 <groupId>org.graalvm.buildtools</groupId>
                 <artifactId>native-maven-plugin</artifactId>
                 <version>0.9.28</version>
             </plugin>
         </plugins>
     </build>
     ```
   - ç¼–è¯‘å‘½ä»¤ï¼š`mvn -Pnative native:compile`ã€‚  

   | **éƒ¨ç½²æ¨¡å¼** | å¯åŠ¨æ—¶é—´ | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯                |
   |--------------|----------|----------|-------------------------|
   | **JVM**      | 2-5s     | 100MB+   | ä¼ ç»Ÿåº”ç”¨ã€å¤æ‚æŸ¥è¯¢      |
   | **Native**   | <100ms   | 20-40MB  | å¾®æœåŠ¡ã€Serverless åœºæ™¯ |

---

### âš ï¸ å…­ã€å¸¸è§é—®é¢˜è§£å†³
- **è¿æ¥è¶…æ—¶**ï¼šæ£€æŸ¥ Dremio æœåŠ¡ç«¯å£ï¼ˆé»˜è®¤ 9047ï¼‰å’Œé˜²ç«å¢™è§„åˆ™ã€‚  
- **ä¾èµ–å†²çª**ï¼šä½¿ç”¨ `mvn dependency:tree` æ’æŸ¥å†²çªï¼Œä¼˜å…ˆç»§æ‰¿ `spring-boot-dependencies` ç®¡ç†ç‰ˆæœ¬ã€‚  
- **è´Ÿè½½å‡è¡¡é—®é¢˜**ï¼šè‹¥éƒ¨ç½²å¤šå®ä¾‹ï¼Œç¡®ä¿ CAS è®¤è¯é…ç½®æ— çŠ¶æ€ï¼ˆå¦‚ç¦ç”¨ Session ç²˜æ»ï¼‰ã€‚

---

### ğŸ’ æ€»ç»“
Spring Boot 3.5.0 æ•´åˆ Dremio çš„æ ¸å¿ƒæ­¥éª¤åŒ…æ‹¬ï¼š  
1. **ä¾èµ–é…ç½®**ï¼šJDBC é©±åŠ¨ + è¿æ¥æ± ä¼˜åŒ–ã€‚  
2. **å¤šç¯å¢ƒéš”ç¦»**ï¼šYAML åˆ†ç¯å¢ƒç®¡ç†æ•°æ®æºã€‚  
3. **æŸ¥è¯¢æ‰§è¡Œ**ï¼š`JdbcTemplate` + Iceberg Time Travel è¯­æ³•ã€‚  
4. **éƒ¨ç½²ä¼˜åŒ–**ï¼šGraalVM åŸç”Ÿç¼–è¯‘æå‡æ€§èƒ½ã€‚  

é€šè¿‡åˆç†åˆ©ç”¨ Dremio çš„ Apache Iceberg é›†æˆèƒ½åŠ›ï¼Œå¯é«˜æ•ˆå®ç°æ•°æ®æ¹–æŸ¥è¯¢ä¸å†å²ç‰ˆæœ¬è¿½æº¯ï¼Œé€‚åˆå®æ—¶åˆ†æåœºæ™¯ã€‚