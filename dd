åœ¨ä½¿ç”¨ Spring çš„ JdbcTemplate æ—¶ï¼Œé˜²æ­¢ SQL æ³¨å…¥çš„æ ¸å¿ƒåŸåˆ™æ˜¯å§‹ç»ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆPrepared Statementsï¼‰ï¼Œè€Œéå­—ç¬¦ä¸²æ‹¼æ¥ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å®è·µå’Œæœ€ä½³æ–¹æ¡ˆï¼š


------

1. ä½¿ç”¨ ? å ä½ç¬¦ + å‚æ•°ä¼ é€’ï¼ˆåŸºç¡€æ–¹æ¡ˆï¼‰

String sql = "SELECT * FROM users WHERE username = ? AND password = ?"; // ç”¨ ? å ä½ç¬¦

// æ­£ç¡®ï¼šä¼ é€’å‚æ•°ï¼ˆJdbcTemplate è‡ªåŠ¨è½¬ä¹‰ï¼‰
jdbcTemplate.query(sql, new Object[]{username, password}, rowMapper);

// æ›´æ–°æ“ä½œç¤ºä¾‹
jdbcTemplate.update("UPDATE users SET status = ? WHERE id = ?", "ACTIVE", userId);


è¯´æ˜ï¼š

â€¢ JdbcTemplate å†…éƒ¨ä½¿ç”¨ PreparedStatementï¼Œæ‰€æœ‰å‚æ•°ä¼šè¢«å®‰å…¨å¤„ç†ã€‚

â€¢ ç¦æ­¢æ‹¼æ¥ SQLï¼š"SELECT ... WHERE user = '" + name + "'" âŒï¼ˆé«˜é£é™©ï¼ï¼‰


------

2. å‘½åå‚æ•°ï¼ˆä½¿ç”¨ NamedParameterJdbcTemplateï¼‰

æ›´å®‰å…¨çš„è¿›é˜¶æ–¹æ¡ˆï¼ˆé¿å…å‚æ•°é¡ºåºé”™è¯¯ï¼‰ï¼š

@Autowired
private NamedParameterJdbcTemplate namedJdbcTemplate; // æ³¨å…¥å‘½åå‚æ•°æ¨¡æ¿

String sql = "SELECT * FROM users WHERE username = :user AND role = :role";

Map<String, Object> params = new HashMap<>();
params.put("user", username);
params.put("role", "admin");

List<User> users = namedJdbcTemplate.query(sql, params, rowMapper);


ä¼˜åŠ¿ï¼š

â€¢ ä½¿ç”¨ :paramName å ä½ç¬¦ï¼Œä»£ç æ›´æ¸…æ™°ã€‚

â€¢ æ”¯æŒå¤æ‚å‚æ•°ï¼ˆå¦‚ Mapã€å¯¹è±¡ï¼‰ã€‚


------

3. é¿å… JdbcTemplate.queryForObject çš„è¯¯åŒº

å½“æŸ¥è¯¢å•å€¼æ—¶ï¼š

// é”™è¯¯ç¤ºä¾‹ï¼ˆæ‹¼æ¥å­—ç¬¦ä¸²ï¼‰âŒ
int count = jdbcTemplate.queryForObject("SELECT COUNT(*) FROM table WHERE col=" + input, Integer.class);

// æ­£ç¡®ç¤ºä¾‹ âœ…
int count = jdbcTemplate.queryForObject("SELECT COUNT(*) FROM table WHERE col=?", Integer.class, input);



------

4. åŠ¨æ€ SQL çš„å®‰å…¨å¤„ç†

éœ€è¦åŠ¨æ€æ¡ä»¶æ—¶ï¼š

â€¢ ä½¿ç”¨ WHERE 1=1 + AND æ¡ä»¶æ‹¼æ¥ï¼ˆä»ç”¨å‚æ•°åŒ–ï¼‰ï¼š

StringBuilder sql = new StringBuilder("SELECT * FROM users WHERE 1=1");
Map<String, Object> params = new HashMap<>();

if (filterByName) {
    sql.append(" AND name = :name");
    params.put("name", name);
}
if (filterByRole) {
    sql.append(" AND role = :role");
    params.put("role", role);
}

namedJdbcTemplate.query(sql.toString(), params, rowMapper);


â€¢ ç¦ç”¨ï¼šsql.append(" AND role = '" + role + "'") âŒï¼ˆç›´æ¥æ‹¼æ¥å±é™©ï¼ï¼‰


------

5. æ¡†æ¶å±‚é˜²æŠ¤

â€¢ JPA / Hibernateï¼šä¼˜å…ˆä½¿ç”¨ JPQL æˆ– Criteria APIï¼ˆè‡ªåŠ¨å‚æ•°åŒ–ï¼‰ã€‚

â€¢ MyBatisï¼šç”¨ #{param} è€Œé ${param}ï¼ˆåè€…ä¸ºæ–‡æœ¬æ›¿æ¢ï¼Œæœ‰æ³¨å…¥é£é™©ï¼‰ã€‚


------

6. é˜²å¾¡æ·±åº¦è¡¥å……

â€¢ è¾“å…¥æ ¡éªŒï¼šå¯¹ç”¨æˆ·è¾“å…¥çš„ usernameã€id ç­‰åšæ ¼å¼æ ¡éªŒï¼ˆå¦‚æ­£åˆ™åŒ¹é…ï¼‰ã€‚

â€¢ æœ€å°æƒé™åŸåˆ™ï¼šæ•°æ®åº“è´¦æˆ·åªèµ‹äºˆå¿…è¦æƒé™ï¼Œç¦ç”¨ DROPã€DELETE ç­‰é«˜å±æ“ä½œã€‚

â€¢ æ—¥å¿—ç›‘æ§ï¼šè®°å½•å¼‚å¸¸ SQL è¯·æ±‚ã€‚


------

æ€»ç»“ï¼šå…³é”®åŸåˆ™

å®‰å…¨åšæ³•	å±é™©åšæ³•
ä½¿ç”¨ ? æˆ– :param	å­—ç¬¦ä¸²æ‹¼æ¥ SQL
é€šè¿‡ Object[] ä¼ é€’å‚æ•°	åœ¨ SQL ä¸­åµŒå…¥ç”¨æˆ·è¾“å…¥
ä½¿ç”¨ NamedParameterJdbcTemplate	æ‰‹åŠ¨æ‹¼æ¥ PreparedStatement

ğŸ“Œ ç»ˆæå‡†åˆ™ï¼šæ‰€æœ‰å¤–éƒ¨è¾“å…¥ï¼ˆç”¨æˆ·/æ¥å£/æ–‡ä»¶ï¼‰å¿…é¡»é€šè¿‡å‚æ•°åŒ–ä¼ é€’åˆ° SQLï¼Œæ°¸è¿œä¸åš SQL å­—ç¬¦ä¸²æ‹¼æ¥ã€‚JdbcTemplate å·²å†…ç½®é˜²å¾¡æœºåˆ¶ï¼Œåªè¦æ­£ç¡®ä½¿ç”¨å‚æ•°å ä½ç¬¦å³å¯é¿å…æ³¨å…¥é£é™©ã€‚